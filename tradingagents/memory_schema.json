{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "TickerMemoryEntry",
  "type": "object",
  "required": ["timestamp", "ticker", "position", "market_snapshot", "strategy", "thesis", "triggers", "current_decision", "next_plan"],
  "additionalProperties": false,
  "properties": {
    "timestamp": { "type": "string", "format": "date-time" },
    "ticker": { "type": "string", "minLength": 1 },
    "position": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "quantity": { "type": "number" },
        "avg_cost": { "type": "number" },
        "last_price": { "type": "number" },
        "unrealized_pl": { "type": "number" },
        "unrealized_pl_pct": { "type": "number" },
        "realized_pl": { "type": "number" },
        "currency": { "type": "string" }
      }
    },
    "market_snapshot": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "as_of": { "type": "string", "format": "date-time" },
        "volatility_regime": { "type": "string" },
        "sentiment": { "type": "string" },
        "day_trades_remaining": { "type": "integer" },
        "market_open": { "type": "boolean" },
        "note": { "type": "string" }
      }
    },
    "strategy": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string" },
        "horizon_hours": { "type": "number" },
        "target_pct": { "type": "number" },
        "stop_pct": { "type": "number" },
        "follow_up": { "type": "string" },
        "urgency": { "type": "string" },
        "deadline": { "type": "string", "format": "date-time" },
        "success_metric": { "type": "string" },
        "failure_metric": { "type": "string" }
      }
    },
    "derived_levels": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "target_price": { "type": "number" },
        "stop_price": { "type": "number" }
      }
    },
    "thesis": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "rationale": { "type": "string" },
        "confidence": { "type": "number" },
        "invalidation": { "type": "string" },
        "key_factors": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "triggers": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["id", "type", "condition", "action"],
        "properties": {
          "id": { "type": "string" },
          "type": { "type": "string", "enum": ["take_profit", "stop_loss", "time", "macro", "custom"] },
          "description": { "type": "string" },
          "condition": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "source": { "type": "string" },
              "operator": { "type": "string" },
              "value": { "type": ["number", "string"] },
              "valid_until": { "type": "string", "format": "date-time" },
              "session": { "type": "string" }
            }
          },
          "action": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "mode": { "type": "string" },
              "order": { "type": "string" },
              "playbook": { "type": "string" }
            }
          },
          "status": { "type": "string" }
        }
      }
    },
    "current_decision": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "action": { "type": "string" },
        "reason": { "type": "string" },
        "valid_until": { "type": "string", "format": "date-time" },
        "confidence": { "type": "number" }
      }
    },
    "next_plan": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "steps": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "id": { "type": "string" },
              "description": { "type": "string" },
              "status": { "type": "string" },
              "due": { "type": "string", "format": "date-time" }
            }
          }
        }
      }
    }
  }
}
